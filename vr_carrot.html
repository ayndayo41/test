<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="main.css">
  <script src="js/aframe-v1.7.0.min.js"></script>
  <script src="js/aframe-orbit-controls.custom.js"></script>
  <script src="js/aframe-extras.min.js"></script>
  <script src="js/jquery-3.5.1.min.js"></script>
  <script src="main.js"></script>
  <script src="js/vr-controls-fix.js"></script>
  <title>KAGOME</title>
  <style>
    body.child #root {
      display: block;
    }
  </style>
</head>

<body class="child">
  <div id="root">

    <div id="screensaver">
      <a-scene embedded device-orientation-permission-ui="enabled: false">
        <a-assets>
          <!-- // 2025/03/05 asakura gyro2 start --- -->
          <video no-muted id="video" autoplay playsinline webkit-playsinline loop="true" src="movie/factory_new/factory_map-nasu_top/factory_top_carrot_vr.mp4"></video>
          <!-- <video id="video" playsinline webkit-playsinline autoplay="false" loop="true" src="movie/factory_top_carrot_vr.mp4"></video> -->
          <!-- // 2025/03/05 asakura gyro2 end --- -->
        </a-assets>
        <a-videosphere src="#video"></a-videosphere>

        <a-entity id='cameraRig'>
          <!-- // 2025/03/05 asakura gyro2 start --- -->
          <!-- <a-entity id="camera" camera look-controls="enabled: true; reverseMouseDrag: false; touchEnabled: true; magicWindowTrackingEnabled: true" wasd-controls="enabled: false"></a-entity> -->
          <!-- <a-entity id="camera" camera look-controls="reverseMouseDrag: false" wasd-controls-enabled="false"></a-entity> -->
          <a-entity id="camera" camera look-controls="enabled: true; reverseMouseDrag: false; touchEnabled: true; magicWindowTrackingEnabled: true" enhanced-look-controls wasd-controls="enabled: false"></a-entity>

          <!-- // 2025/03/05 asakura gyro2 end --- -->
        </a-entity>
      </a-scene>
    </div>
    <div id="video-controls">
      <button id="backward-btn"><i class="fas fa-backward"></i></button>
      <button id="play-pause-btn"><i class="fas fa-play"></i></button>
      <button id="forward-btn"><i class="fas fa-forward"></i></button>
      <span id="current-time" style="display:none;">0:00</span>
      <input type="range" id="seek-bar" min="0" value="0" step="0.1" style="display:none;">
      <span id="duration" style="display:none;">0:00</span>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const video = document.getElementById('video');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const forwardBtn = document.getElementById('forward-btn');
    const backwardBtn = document.getElementById('backward-btn');
    const seekBar = document.getElementById('seek-bar');
    const currentTimeEl = document.getElementById('current-time');
    const durationEl = document.getElementById('duration');

    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
    
    // シークバーの最大値を設定
    video.addEventListener('loadedmetadata', function() {
      seekBar.max = video.duration;
      durationEl.textContent = formatTime(video.duration);
    });
    
    // 再生/一時停止ボタンのクリックイベント
    playPauseBtn.addEventListener('click', function() {
      if (video.paused || video.ended) {
        video.play();
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
      } else {
        video.pause();
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
      }
    });
    
    // シークバーの値が変更されたときのイベント
    seekBar.addEventListener('change', function() {
      video.currentTime = seekBar.value;
    });
    
    // ビデオの再生中に時間とシークバーを更新
    video.addEventListener('timeupdate', function() {
      seekBar.value = video.currentTime;
      currentTimeEl.textContent = formatTime(video.currentTime);
    });
    
    // 再生が終了したときのイベント
    // video.addEventListener('ended', function() {
    //   playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
    //   seekBar.value = 0;
    // });
    video.addEventListener('ended', function() {
      // loopがtrueの場合は自動的に再開するので、一時停止アイコンのまま
      if (!video.loop) {
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        seekBar.value = 0;
      }
    });
    
    // 早送りボタンのクリックイベント
    forwardBtn.addEventListener('click', function() {
      // 現在の再生時間に10秒加える
      video.currentTime = Math.min(video.currentTime + 10, video.duration);
    });
    
    // 巻き戻しボタンのクリックイベント
    backwardBtn.addEventListener('click', function() {
      // 現在の再生時間から10秒引く
      video.currentTime = Math.max(video.currentTime - 10, 0);
    });
    
    // 時間を分:秒形式でフォーマットする関数
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      seconds = Math.floor(seconds % 60);
      return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }
    
    // VRモードでも操作できるようにする
    // A-Frameのシーン内でのインタラクションを保持
    const scene = document.querySelector('a-scene');
    scene.addEventListener('enter-vr', function() {
      // VRモードに入ったときの処理
      // VR内でのコントロール表示方法を調整できます
    });
  });
  </script>
</body>

</html>